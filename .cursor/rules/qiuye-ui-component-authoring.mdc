---
alwaysApply: true
name: qiuye-ui-component-authoring
description: 用于 QiuYe UI（基于 shadcn/ui + Next.js App Router）的自定义组件新增、注册、展示与 Registry 集成的完整编码与发布规范。
---

## 你是谁（Cursor Agent 行为准则）

你是本仓库（自定义 shadcn/ui 组件库 + Next.js 展示站点）的编码代理。你的输出和代码修改必须以**不遗漏步骤**、**可复现**、**与现有结构保持一致**为第一优先级。

- 语言：所有解释/注释优先使用**中文（简体）**。
- 技术栈：Next.js App Router（`app/`）、React 19、TypeScript、Tailwind CSS、shadcn/ui（`components/ui`）、自定义组件（`components/qiuye-ui`）。
- 包管理：仓库内以 **pnpm** 为准（除非用户明确要求 npm/yarn）。

---

## 项目关键结构（必须理解）

- **基础组件（shadcn/ui）**：`components/ui/*`  
  - 由 shadcn CLI 生成/维护，尽量不要在没有明确需求时大改其 API。
- **自定义组件库（QiuYe UI）**：`components/qiuye-ui/*`  
  - 每个自定义组件一个文件（kebab-case）。
  - 对应的演示组件：`components/qiuye-ui/demos/*-demo.tsx`
- **站点：组件列表与详情页**：
  - 列表页：`app/components/page.tsx`（数据来自 `lib/registry.ts`）
  - 详情页：`app/components/[id]/page.tsx`（需要把 demo 映射进来）
  - 详情页快速预览 demo：`app/components/[id]/simple-demos.tsx`（手动维护）
- **站点：CLI 文档页**：`app/cli/page.tsx`（含“可用组件列表”，当前是手动数组）
- **站点侧注册表（用于展示/检索）**：
  - 组件 ID/基础用法：`lib/component-constants.ts`
  - 组件元信息注册表：`lib/registry.ts`
- **shadcn Registry（给 shadcn CLI 安装用）**：
  - `public/registry/<name>.json`：单组件 registry item（包含源码 content）
  - `public/registry/index.json`：索引（由脚本生成，避免手改）
  - 更新脚本：`scripts/update-registry.mjs`（仓库脚本：`pnpm update-registry`）
- **shadcn CLI Registry 配置**：`components.json`
  - 本地开发默认：`"@qiuye-ui": "http://localhost:3000/registry/{name}.json"`

---

## 最重要：给本组件库新增「自定义组件」的完整流程（不得遗漏）

> 目标：新增一个可在站点展示、可在 `/registry/<name>.json` 访问、可被 `shadcn add @qiuye-ui/<name>` 安装的组件。

### 0）命名与范围确认（必须做）

- **组件 ID**：使用 **kebab-case**，例如 `fancy-card`  
- **组件导出名**：使用 **PascalCase**，例如 `FancyCard`
- **决定是否是 Client Component**：
  - 只要用到 hooks、事件处理、`motion/react` 动画、`useState/useEffect` 等，就必须在组件文件顶部加 `"use client";`
- **列清依赖**
  - **dependencies（npm 包）**：例如 `motion`、`lucide-react`、`class-variance-authority`
  - **registryDependencies（shadcn 组件名）**：例如 `tabs`、`badge`、`dialog`（这些是 shadcn CLI 能识别/拉取的依赖组件）

### 1）实现组件源码（必须）

- 新增文件：`components/qiuye-ui/<id>.tsx`
- 规范要求：
  - 用 `@/lib/utils` 的 `cn` 合并 className
  - 需要 ref 的组件优先用 `React.forwardRef`
  - 导出保持与现有组件一致（`export { Xxx }`，必要时导出 variants）
  - 组件 API（props）要明确：类型、默认值、可选/必选

### 2）实现 Demo（必须）

- 新增文件：`components/qiuye-ui/demos/<id>-demo.tsx`
- Demo 要求：
  - 覆盖核心能力/典型场景
  - 作为站点详情页 “演示” Tab 的主要内容

### 3）补齐站点侧注册信息（必须）

#### 3.1 更新组件 ID 枚举与基础用法

编辑 `lib/component-constants.ts`：

- 在 `ComponentId` enum 中新增 `NEW_COMPONENT = "<id>"`  
- 在 `basicUsageExamples` 中新增对应项：
  - `import`：必须使用 `@/components/qiuye-ui/<id>` 路径
  - `usage`：给出最小可运行用法（可包含必要的 state 示例）

#### 3.2 更新组件元信息注册表

编辑 `lib/registry.ts`：

- 在 `componentRegistry` 新增条目（key 使用 `ComponentId.<NEW>`）：
  - `name / description / category / tags`
  - `dependencies`（npm 包名数组）
  - `files.component = "components/qiuye-ui/<id>.tsx"`
  - `files.demo = "components/qiuye-ui/demos/<id>-demo.tsx"`
  - `props`（单组件）或 `propsInfo`（多子组件导出时使用）
  - `cliName = "<id>"`
  - `basicUsage = basicUsageExamples[ComponentId.<NEW>]`

### 4）把 Demo 接入详情页（必须，否则详情页会显示“演示组件正在开发中...”）

编辑 `app/components/[id]/page.tsx`：

- `import { XxxDemo } from "@/components/qiuye-ui/demos/<id>-demo";`
- 在 `demoComponents` 对象里新增映射：`[ComponentId.<NEW>]: XxxDemo`

同时编辑 `app/components/[id]/simple-demos.tsx`（用于“快速预览”）：

- 新增 `XxxSimpleDemo()` 组件（尽量简单、无复杂交互）
- 在 `app/components/[id]/page.tsx` 的 `simpleDemoComponents` 中新增映射

### 5）补齐 CLI 文档页（建议做，避免文档漏列）

编辑 `app/cli/page.tsx`：

- 在 “可用组件列表” 的数组中加入新 `ComponentId.<NEW>`
  - （当前是手动维护；若你顺手能改成从 `COMPONENT_IDS` 动态生成也可以，但要确保 UI/动画逻辑不被破坏）

### 6）新增 registry item JSON（必须，给 shadcn CLI 用）

新增文件：`public/registry/<id>.json`（可先不写 content，让脚本生成）

最低要求字段（与现有文件保持一致）：

- `"$schema": "https://ui.shadcn.com/schema/registry-item.json"`
- `"name": "<id>"`
- `"title": "<PascalCaseName>"`
- `"type": "registry:component"`
- `"author": "QiuYeDx <me@qiuyedx.com>"`（或保持当前作者格式）
- `"dependencies": [...]`（npm 包）
- `"registryDependencies": [...]`（shadcn 组件名）
- `"files": [{ "type": "registry:component", "path": "components/qiuye-ui/<id>.tsx", "target": "src/components/qiuye-ui/<id>.tsx" }]`

注意：
- 不要手动维护 `files[].content`（容易过期），后续用脚本自动写入。
- `public/registry/index.json` **不要手改**，由脚本生成。
- 如果组件需要**拆分多个文件**（例如 `types.ts` / `utils.ts` / 多个导出文件），必须把这些文件都加入 `files[]`，否则用户通过 shadcn CLI 安装后会缺文件。
  - 为了让 `pnpm update-registry` 能自动写入源码内容，建议这些条目的 `type` 也使用 `registry:component`。

### 7）更新 registry 内容与索引（必须）

在仓库根目录执行：

- `pnpm update-registry`

该命令会：
- 把 `public/registry/*.json` 中 `files[].content` 更新为 `components/qiuye-ui/*` 的真实源码
- 重新生成 `public/registry/index.json`

### 8）本地验证（必须做完再结束）

- **站点验证**：
  - `pnpm dev` 后打开：
    - `/components`：列表中能看到新组件（分类/搜索正常）
    - `/components/<id>`：详情页能渲染 demo、快速预览、API 表格、依赖区块
- **Registry 验证**（用于 shadcn CLI）：
  - 访问：`http://localhost:3000/registry/<id>.json`
  - 确认 JSON 中 `files[0].content` 与源码一致、依赖字段完整
- **可选：CLI 安装验证（需要本地 dev server 正在运行）**：
  - 在任意测试项目里：`pnpm dlx shadcn@latest add @qiuye-ui/<id>`

---

## 修改约束（避免破坏现有行为）

- 不要随意改变已有组件导出名/文件名（这会破坏 registry/文档/安装路径）。
- `public/registry/index.json` 不手工编辑；通过 `pnpm update-registry` 生成。
- 新增依赖时：
  - 用 `pnpm add <pkg>`（或 `pnpm add -D <pkg>`）
  - **必须**同步更新 `public/registry/<id>.json` 的 `"dependencies"` / `"registryDependencies"`（这是 shadcn CLI 安装时依赖解析的依据）
  - `lib/registry.ts` 的 `dependencies` 用于站点展示/复制安装命令：可精简，但不要漏掉用户实际需要的关键三方依赖（例如 `motion`、`lucide-react`、`class-variance-authority` 等）

---

## 可选：发布/工具链补齐（做库发布时建议同步）

- 如果你要发布/更新 MCP Server（`packages/qiuye-ui-cli`）并希望在远端缺少 `index.json` 时也能列出新组件：
  - 更新 `packages/qiuye-ui-cli/bin/qiuye-ui-mcp.mjs` 里的 `DEFAULT_COMPONENT_NAMES`（兜底列表）

---

## 提交前自检（如果你做了较大改动）

- `pnpm lint`
- 关键页面能打开且无运行时报错：`/components`、`/components/<id>`、`/cli`
