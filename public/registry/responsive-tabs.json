{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "responsive-tabs",
  "title": "ResponsiveTabs",
  "type": "registry:component",
  "author": "QiuYeDx <me@qiuyedx.com>",
  "dependencies": [
    "react",
    "lucide-react",
    "motion"
  ],
  "registryDependencies": [
    "tabs",
    "badge",
    "button"
  ],
  "files": [
    {
      "type": "registry:component",
      "path": "components/qiuye-ui/responsive-tabs.tsx",
      "content": "\"use client\";\n\nimport React, { useRef, useEffect } from \"react\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { AnimatePresence, motion } from \"motion/react\";\n\n/** 单个 Tab 选项的配置 */\nexport interface TabItem {\n  /** Tab 的唯一标识值，对应 `ResponsiveTabs` 的 `value` / `onValueChange` */\n  value: string;\n  /** Tab 显示的文本标签 */\n  label: string;\n  /** Tab 标签前方的图标（可选） */\n  icon?: React.ReactNode;\n  /** Tab 标签后方的徽标，传入 `number` 或 `string`（可选） */\n  badge?: number | string;\n  /** 是否禁用此 Tab */\n  disabled?: boolean;\n}\n\n/**\n * 布局模式\n * - `\"responsive\"` — 小屏横向滚动，大屏（≥sm）切换为 grid 布局\n * - `\"scroll\"` — 始终横向滚动\n * - `\"grid\"` — 始终 grid 网格布局\n */\ntype LayoutMode = \"responsive\" | \"scroll\" | \"grid\";\n\n/**\n * Tab 尺寸\n * - `\"default\"` — 默认尺寸\n * - `\"sm\"` — 紧凑小尺寸，适用于工具栏、表单内嵌等场景\n */\ntype TabSize = \"default\" | \"sm\";\n\n/** ResponsiveTabs 组件的属性 */\nexport interface ResponsiveTabsProps {\n  /** 当前激活的 Tab 值 */\n  value: string;\n  /** Tab 切换时的回调，参数为新激活的 Tab `value` */\n  onValueChange: (value: string) => void;\n  /** Tab 选项列表 */\n  items: TabItem[];\n  /** Tab 面板内容（`TabsContent` 区域），不传则不渲染内容区域 */\n  children?: React.ReactNode;\n  /**\n   * 是否显示左右滚动箭头按钮（仅在滚动模式下生效）\n   * @default true\n   */\n  scrollButtons?: boolean;\n  /**\n   * 点击滚动按钮时每次滚动的步长（像素）\n   * @default 220\n   */\n  scrollStep?: number;\n  /**\n   * ≥sm 断点下的网格列数 Tailwind 类名（应用在 TabsList 上）\n   *\n   * 在 `layout=\"grid\"` 时请提供无断点或自定义断点的类\n   * @default \"sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8\"\n   */\n  gridColsClass?: string;\n  /** TabsList 容器的自定义 className */\n  listClassName?: string;\n  /** 每个 TabsTrigger 的自定义 className */\n  triggerClassName?: string;\n  /**\n   * 布局模式\n   * - `\"responsive\"` — 小屏横向滚动，大屏（≥sm）切换为 grid 布局（默认）\n   * - `\"scroll\"` — 始终横向滚动\n   * - `\"grid\"` — 始终 grid 网格布局\n   * @default \"responsive\"\n   */\n  layout?: LayoutMode;\n  /** 根容器的自定义 className */\n  className?: string;\n  /**\n   * 是否在滚动模式下显示左右渐变遮罩，用于提示可滚动\n   * @default true\n   */\n  fadeMasks?: boolean;\n  /**\n   * 渐变遮罩宽度（像素）\n   * @default 64\n   */\n  fadeMaskWidth?: number;\n  /**\n   * 是否启用选中态 layoutId 底色平移过渡动画\n   *\n   * 开启后，切换 Tab 时选中高亮背景会以弹簧动画从上一个 Tab 滑动到新 Tab，\n   * 而非默认的即时切换。\n   * @default true\n   */\n  animatedHighlight?: boolean;\n  /**\n   * Tab 整体尺寸\n   * - `\"default\"` — 默认尺寸\n   * - `\"sm\"` — 紧凑小尺寸，触发器更小、文字更紧凑，适用于工具栏、表单内嵌等场景\n   * @default \"default\"\n   */\n  size?: TabSize;\n}\n\n/**\n * ResponsiveTabs — 响应式标签页组件\n *\n * 基于 shadcn/ui Tabs 扩展，根据屏幕宽度自动切换布局：\n * - **小屏**：横向滚动模式，支持左右箭头按钮和渐变遮罩提示\n * - **大屏**：网格布局模式，Tab 选项平铺展示\n *\n * 支持三种布局模式：`responsive`（自动切换）、`scroll`（始终滚动）、`grid`（始终网格）。\n * 每个 Tab 选项支持图标、徽标、禁用等配置。\n *\n * @example\n * ```tsx\n * const [tab, setTab] = useState(\"all\");\n *\n * <ResponsiveTabs\n *   value={tab}\n *   onValueChange={setTab}\n *   items={[\n *     { value: \"all\", label: \"全部\" },\n *     { value: \"ui\", label: \"UI 组件\", icon: <LayoutIcon />, badge: 12 },\n *     { value: \"hooks\", label: \"Hooks\", disabled: true },\n *   ]}\n * >\n *   <TabsContent value=\"all\">全部内容</TabsContent>\n *   <TabsContent value=\"ui\">UI 组件内容</TabsContent>\n * </ResponsiveTabs>\n * ```\n */\nconst ResponsiveTabs = React.forwardRef<\n  React.ElementRef<typeof Tabs>,\n  ResponsiveTabsProps\n>(\n  (\n    {\n      value,\n      onValueChange,\n      items,\n      children,\n      scrollButtons = true,\n      scrollStep = 220,\n      gridColsClass = \"sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8\",\n      listClassName,\n      triggerClassName,\n      layout = \"responsive\",\n      className,\n      fadeMasks = true,\n      fadeMaskWidth = 64,\n      animatedHighlight = true,\n      size = \"default\",\n      ...props\n    },\n    ref\n  ) => {\n    // layoutId 动画高亮的唯一前缀（避免多实例冲突）\n    const instanceId = React.useId();\n    const isSm = size === \"sm\";\n\n    // 背景容器（不滚）\n    const tabsListRef = useRef<HTMLDivElement>(null);\n    // 可滚动轨道（只滚内容）\n    const scrollerRef = useRef<HTMLDivElement>(null);\n\n    const [showLeftButton, setShowLeftButton] = React.useState(false);\n    const [showRightButton, setShowRightButton] = React.useState(false);\n    const [showLeftFade, setShowLeftFade] = React.useState(false);\n    const [showRightFade, setShowRightFade] = React.useState(false);\n\n    const isScrollAll = layout === \"scroll\";\n    const isGridAll = layout === \"grid\";\n    const isResponsive = layout === \"responsive\";\n\n    // 更新滚动按钮和遮罩状态 —— 基于 scrollerRef\n    const checkScrollAffordance = React.useCallback(() => {\n      const el = scrollerRef.current;\n      if (!el) return;\n      const { scrollLeft, scrollWidth, clientWidth } = el;\n\n      if (scrollButtons) {\n        setShowLeftButton(scrollLeft > 0);\n        setShowRightButton(scrollLeft + clientWidth < scrollWidth - 1);\n      }\n\n      if (fadeMasks && (isScrollAll || isResponsive)) {\n        const maxScroll = scrollWidth - clientWidth;\n        setShowLeftFade(scrollLeft > 1);\n        setShowRightFade(maxScroll > 0 && scrollLeft < maxScroll - 1);\n      }\n    }, [scrollButtons, fadeMasks, isScrollAll, isResponsive]);\n\n    // 左右滚动\n    const scrollByDir = (dir: \"left\" | \"right\") => {\n      const el = scrollerRef.current;\n      if (!el) return;\n      el.scrollBy({\n        left: dir === \"left\" ? -scrollStep : scrollStep,\n        behavior: \"smooth\",\n      });\n    };\n\n    // 滚到激活项（只移动 scroller，不动背景）\n    const scrollToActiveTab = React.useCallback(() => {\n      const scroller = scrollerRef.current;\n      const list = tabsListRef.current;\n      if (!scroller || !list) return;\n\n      const active = list.querySelector<HTMLElement>('[data-state=\"active\"]');\n      if (!active) return;\n\n      const cRect = scroller.getBoundingClientRect();\n      const aRect = active.getBoundingClientRect();\n      const fullyVisible =\n        aRect.left >= cRect.left && aRect.right <= cRect.right;\n\n      if (!fullyVisible) {\n        const targetLeft =\n          active.offsetLeft - (scroller.clientWidth - active.clientWidth) / 2;\n        scroller.scrollTo({\n          left: Math.max(0, targetLeft),\n          behavior: \"smooth\",\n        });\n      }\n    }, []);\n\n    // 监听滚动与尺寸变化\n    useEffect(() => {\n      const el = scrollerRef.current;\n      if (!el) return;\n\n      const onScroll = () => checkScrollAffordance();\n      el.addEventListener(\"scroll\", onScroll, { passive: true });\n      checkScrollAffordance();\n\n      const ro = new ResizeObserver(() => {\n        checkScrollAffordance();\n        scrollToActiveTab();\n      });\n      ro.observe(el);\n\n      const onWinResize = () => {\n        checkScrollAffordance();\n        scrollToActiveTab();\n      };\n      window.addEventListener(\"resize\", onWinResize);\n\n      return () => {\n        el.removeEventListener(\"scroll\", onScroll);\n        ro.disconnect();\n        window.removeEventListener(\"resize\", onWinResize);\n      };\n    }, [checkScrollAffordance, scrollToActiveTab]);\n\n    // 将纵向滚轮转为横向滚（仅 scroll 模式）\n    useEffect(() => {\n      if (!isScrollAll) return;\n      const el = scrollerRef.current;\n      if (!el) return;\n\n      const onWheel = (e: WheelEvent) => {\n        if (Math.abs(e.deltaX) > Math.abs(e.deltaY)) return;\n        if (e.ctrlKey) return;\n\n        const hasOverflowX = el.scrollWidth > el.clientWidth;\n        if (!hasOverflowX) return;\n\n        const max = el.scrollWidth - el.clientWidth;\n        const atStart = el.scrollLeft <= 0;\n        const atEnd = el.scrollLeft >= max - 1;\n\n        const goingLeft = e.deltaY < 0;\n        const goingRight = e.deltaY > 0;\n\n        if ((goingLeft && !atStart) || (goingRight && !atEnd)) {\n          e.preventDefault();\n          el.scrollBy({ left: e.deltaY, behavior: \"auto\" });\n          checkScrollAffordance();\n        }\n      };\n\n      el.addEventListener(\"wheel\", onWheel, { passive: false });\n      return () => el.removeEventListener(\"wheel\", onWheel);\n    }, [isScrollAll, checkScrollAffordance]);\n\n    // value 改变时，确保激活项可见\n    useEffect(() => {\n      if (isGridAll) return;\n      scrollToActiveTab();\n    }, [value, isGridAll, scrollToActiveTab]);\n\n    // 类名计算\n    // 外层相对定位容器，仅用于放置按钮/遮罩层（不承担滚动）\n    const outerRelativeClass = \"relative w-full overflow-x-hidden\";\n\n    // TabsList：固定背景层（圆角灰底通常在这里），不滚动，负责 padding（edge gutter）\n    const listClass = cn(\n      // grid/responsive 的列定义（只在需要 grid 时作用）\n      (isGridAll || isResponsive) && gridColsClass,\n      \"h-auto w-full overflow-hidden\", // 关键：overflow-hidden，固定背景\n      // 当大屏 grid 时让内部布局切换到 grid（见 rowClass）\n      listClassName\n    );\n\n    // scroller：真正滚动的层\n    const scrollerClass = cn(\n      \"w-full p-0.5\",\n      isGridAll\n        ? \"overflow-visible\"\n        : isScrollAll\n          ? \"overflow-x-auto\"\n          : \"overflow-x-auto sm:overflow-visible\",\n      // 隐藏滚动条\n      !isGridAll &&\n      \"[scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden\",\n      // 阻断 inline 方向滚动链\n      \"overscroll-contain\"\n    );\n\n    // row：承载触发器的行；滚动场景下 inline-flex + w-max，grid 场景下切为 grid\n    const rowClass = cn(\n      isGridAll\n        ? \"grid w-full gap-0\"\n        : isScrollAll\n          ? \"inline-flex w-max whitespace-nowrap gap-1\"\n          : \"inline-flex w-max whitespace-nowrap gap-1 sm:grid sm:w-full sm:gap-0\",\n      (isGridAll || isResponsive) && gridColsClass\n    );\n\n    const triggerClass = cn(\n      isSm ? \"px-2 py-1 text-xs\" : \"px-3 py-2\",\n      !isGridAll && \"shrink-0 min-w-fit\",\n      isGridAll && \"shrink min-w-0 flex items-center justify-center\",\n      isResponsive &&\n      \"sm:shrink sm:min-w-0 sm:flex sm:items-center sm:justify-center\",\n      \"data-[state=active]:font-medium\",\n      // 当启用 layoutId 动画高亮时，取消 trigger 自带的选中态背景/阴影/边框，改由 motion.span 承载\n      animatedHighlight &&\n      \"relative data-[state=active]:bg-transparent data-[state=active]:shadow-none dark:data-[state=active]:bg-transparent dark:data-[state=active]:border-transparent\",\n      triggerClassName\n    );\n\n    const buttonVisibilityClass = isScrollAll ? \"\" : \"sm:hidden\";\n\n    return (\n      <Tabs\n        ref={ref}\n        value={value}\n        onValueChange={onValueChange}\n        className={cn(\"w-full\", className)}\n        {...props}\n      >\n        <div className={outerRelativeClass}>\n          {/* 左侧按钮 */}\n          <AnimatePresence>\n            {scrollButtons && !isGridAll && showLeftButton && (\n              <motion.div\n                className={cn(\n                  \"absolute top-1/2 z-10 -translate-y-1/2 rounded-full bg-background/80 p-0 shadow-md backdrop-blur-sm origin-left\",\n                  isSm ? \"left-0.5 h-6 w-6\" : \"left-1 h-8 w-8\"\n                )}\n                initial={{ opacity: 0, scale: 0, x: -10 }}\n                animate={{ opacity: 1, scale: 1, x: 0 }}\n                exit={{ opacity: 0, scale: 0, x: -10 }}\n                transition={{ duration: 0.15 }}\n              >\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className={cn(\n                    \"rounded-full hover:bg-transparent cursor-pointer\",\n                    isSm ? \"h-6 w-6 size-6\" : \"h-8 w-8 size-8\",\n                    buttonVisibilityClass\n                  )}\n                  onClick={() => scrollByDir(\"left\")}\n                  aria-label=\"向左滚动\"\n                >\n                  <ChevronLeft className={isSm ? \"h-3 w-3\" : \"h-4 w-4\"} />\n                </Button>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {/* 右侧按钮 */}\n          <AnimatePresence>\n            {scrollButtons && !isGridAll && showRightButton && (\n              <motion.div\n                className={cn(\n                  \"absolute top-1/2 z-10 -translate-y-1/2 rounded-full bg-background/80 p-0 shadow-md backdrop-blur-sm origin-right\",\n                  isSm ? \"right-0.5 h-6 w-6\" : \"right-1 h-8 w-8\"\n                )}\n                initial={{ opacity: 0, scale: 0, x: 10 }}\n                animate={{ opacity: 1, scale: 1, x: 0 }}\n                exit={{ opacity: 0, scale: 0, x: 10 }}\n                transition={{ duration: 0.15 }}\n              >\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className={cn(\n                    \"rounded-full hover:bg-transparent cursor-pointer\",\n                    isSm ? \"h-6 w-6 size-6\" : \"h-8 w-8 size-8\",\n                    buttonVisibilityClass\n                  )}\n                  onClick={() => scrollByDir(\"right\")}\n                  aria-label=\"向右滚动\"\n                >\n                  <ChevronRight className={isSm ? \"h-3 w-3\" : \"h-4 w-4\"} />\n                </Button>\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {/* 固定背景层 TabsList（不滚动） */}\n          <TabsList ref={tabsListRef} className={listClass}>\n            {/* 仅 scroller 层滚动 */}\n            <div ref={scrollerRef} className={scrollerClass}>\n              {/* 真正承载触发器的行 */}\n              <div className={rowClass}>\n                {items.map((item) => (\n                  <TabsTrigger\n                    key={item.value}\n                    value={item.value}\n                    disabled={item.disabled}\n                    className={triggerClass}\n                  >\n                    {/* layoutId 动画高亮底色 */}\n                    {animatedHighlight && value === item.value && (\n                      <motion.span\n                        layoutId={`${instanceId}-tab-highlight`}\n                        className=\"absolute inset-0 rounded-md bg-background shadow-sm dark:border dark:border-input dark:bg-input/30\"\n                        transition={{\n                          type: \"spring\",\n                          bounce: 0.15,\n                          duration: 0.4,\n                        }}\n                      />\n                    )}\n                    <span\n                      className={cn(\n                        \"flex items-center max-w-full\",\n                        isSm ? \"gap-1.5\" : \"gap-2\",\n                        animatedHighlight && \"relative z-[1]\"\n                      )}\n                    >\n                      {item.icon && (\n                        <span className=\"shrink-0\">{item.icon}</span>\n                      )}\n                      <span className=\"truncate\">{item.label}</span>\n                      {item.badge !== undefined && (\n                        <Badge\n                          variant=\"secondary\"\n                          className={\n                            isSm\n                              ? \"ml-0.5 h-3.5 min-w-[16px] px-0.5 text-[10px]\"\n                              : \"ml-1 h-4 min-w-[20px] px-1 text-xs\"\n                          }\n                        >\n                          {item.badge}\n                        </Badge>\n                      )}\n                    </span>\n                  </TabsTrigger>\n                ))}\n              </div>\n            </div>\n\n            {/* 渐变遮罩 */}\n            <AnimatePresence>\n              {fadeMasks && (isScrollAll || isResponsive) && showLeftFade && (\n                <motion.div\n                  aria-hidden=\"true\"\n                  className=\"rounded-lg pointer-events-none absolute left-0 top-0 bottom-0 z-[5] bg-gradient-to-r from-muted to-transparent\"\n                  style={{ width: `${fadeMaskWidth}px` }}\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  exit={{ opacity: 0 }}\n                  transition={{ duration: 0.3 }}\n                />\n              )}\n            </AnimatePresence>\n            <AnimatePresence>\n              {fadeMasks && (isScrollAll || isResponsive) && showRightFade && (\n                <motion.div\n                  aria-hidden=\"true\"\n                  className=\"rounded-lg pointer-events-none absolute right-0 top-0 bottom-0 z-[5] bg-gradient-to-l from-muted to-transparent\"\n                  style={{ width: `${fadeMaskWidth}px` }}\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  exit={{ opacity: 0 }}\n                  transition={{ duration: 0.3 }}\n                />\n              )}\n            </AnimatePresence>\n          </TabsList>\n        </div>\n\n        {children != null && <div className=\"mt-4\">{children}</div>}\n      </Tabs>\n    );\n  }\n);\n\nResponsiveTabs.displayName = \"ResponsiveTabs\";\nexport { ResponsiveTabs, TabsContent };\n"
    }
  ]
}
