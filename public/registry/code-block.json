{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "code-block",
  "title": "CodeBlock",
  "type": "registry:component",
  "author": "QiuYeDx <me@qiuyedx.com>",
  "dependencies": [
    "prism-react-renderer",
    "motion",
    "lucide-react"
  ],
  "registryDependencies": [
    "@qiuye-ui/dual-state-toggle"
  ],
  "files": [
    {
      "type": "registry:component",
      "path": "components/qiuye-ui/code-block/code-block-panel.tsx",
      "content": "\"use client\";\n\nimport React, { useState, useCallback } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Check, Copy } from \"lucide-react\";\nimport { DualStateToggle } from \"@/components/qiuye-ui/dual-state-toggle\";\nimport type { CodeBlockColorThemeName } from \"./code-block-themes\";\n\n// ============================================\n// Panel 主题配色\n// ============================================\n\n/**\n * 每套主题对应的面板外壳背景色\n *\n * 面板背景比代码区域背景略深，营造容器层次感。\n */\nconst PANEL_BG: Record<\n  CodeBlockColorThemeName,\n  { dark: string; light: string }\n> = {\n  qiuvision: { dark: \"#111113\", light: \"#E5E5E3\" },\n  github: { dark: \"#010409\", light: \"#EEF1F5\" },\n  one: { dark: \"#21252B\", light: \"#E6E7E8\" },\n  dracula: { dark: \"#21222C\", light: \"#EAEAE5\" },\n  nord: { dark: \"#252B35\", light: \"#DEE2EA\" },\n  vitesse: { dark: \"#0A0A0A\", light: \"#EBEBEB\" },\n  monokai: { dark: \"#1E1F1A\", light: \"#EBEBEA\" },\n};\n\n/** 面板亮暗模式下的文本 / 图标通用配色 */\nconst PANEL_TEXT = {\n  dark: {\n    border: \"rgba(255,255,255,0.08)\",\n    filename: \"rgba(255,255,255,0.4)\",\n    btn: \"rgba(255,255,255,0.4)\",\n    btnHover: \"rgba(255,255,255,0.7)\",\n    btnHoverBg: \"rgba(255,255,255,0.1)\",\n    check: \"#34d399\",\n  },\n  light: {\n    border: \"rgba(0,0,0,0.08)\",\n    filename: \"rgba(0,0,0,0.45)\",\n    btn: \"rgba(0,0,0,0.35)\",\n    btnHover: \"rgba(0,0,0,0.65)\",\n    btnHoverBg: \"rgba(0,0,0,0.06)\",\n    check: \"#059669\",\n  },\n} as const;\n\n// ============================================\n// 语言显示名称映射\n// ============================================\n\n/** 常见编程语言的显示名称映射 */\nconst LANGUAGE_DISPLAY_NAMES: Record<string, string> = {\n  typescript: \"TypeScript\",\n  javascript: \"JavaScript\",\n  tsx: \"TSX\",\n  jsx: \"JSX\",\n  python: \"Python\",\n  css: \"CSS\",\n  scss: \"SCSS\",\n  less: \"Less\",\n  html: \"HTML\",\n  json: \"JSON\",\n  yaml: \"YAML\",\n  xml: \"XML\",\n  markdown: \"Markdown\",\n  bash: \"Bash\",\n  shell: \"Shell\",\n  sh: \"Shell\",\n  zsh: \"Zsh\",\n  sql: \"SQL\",\n  graphql: \"GraphQL\",\n  rust: \"Rust\",\n  go: \"Go\",\n  java: \"Java\",\n  kotlin: \"Kotlin\",\n  swift: \"Swift\",\n  ruby: \"Ruby\",\n  php: \"PHP\",\n  csharp: \"C#\",\n  cpp: \"C++\",\n  c: \"C\",\n  dart: \"Dart\",\n  r: \"R\",\n  lua: \"Lua\",\n  perl: \"Perl\",\n  scala: \"Scala\",\n  diff: \"Diff\",\n  dockerfile: \"Dockerfile\",\n  docker: \"Docker\",\n  toml: \"TOML\",\n  ini: \"INI\",\n  vue: \"Vue\",\n  svelte: \"Svelte\",\n};\n\n/**\n * 获取编程语言的格式化显示名称\n *\n * 优先使用内置映射表；未命中时回退到首字母大写。\n * 对于 \"plaintext\" 返回 null（不适合作为标签显示）。\n */\nfunction getLanguageDisplayName(language: string): string | null {\n  const lower = language.toLowerCase();\n  if (lower === \"plaintext\" || lower === \"text\" || lower === \"plain\") {\n    return null;\n  }\n  return LANGUAGE_DISPLAY_NAMES[lower] ?? language.charAt(0).toUpperCase() + language.slice(1);\n}\n\n// ============================================\n// CodeBlockPanel 组件\n// ============================================\n\nexport interface CodeBlockPanelProps {\n  /** 文件名标签（显示在面板顶部左侧） */\n  filename?: string;\n  /**\n   * 编程语言标识（当未设置 filename 时，作为 fallback 标签显示语言类型）\n   *\n   * 传入后若 filename 为空且 showLanguageLabel 为 true，\n   * 会在面板顶部左侧显示格式化后的语言名称（如 \"TypeScript\"、\"Python\"）。\n   */\n  language?: string;\n  /**\n   * 是否在未设置 filename 时自动显示语言类型标签（默认 true）\n   *\n   * 设为 false 后即使传入了 language，也不会作为 fallback 标签显示。\n   */\n  showLanguageLabel?: boolean;\n  /**\n   * 代码文本内容（用于复制按钮功能）\n   *\n   * 传入后复制按钮自动可用；不传则不显示复制按钮。\n   */\n  code?: string;\n  /** 是否显示复制按钮（需要同时传入 code，默认 true） */\n  showCopyButton?: boolean;\n  /** 是否为深色模式（控制面板配色的浅色/深色变体选择，默认 true） */\n  isDark?: boolean;\n  /**\n   * 内置配色主题名称（默认 \"qiuvision\"）\n   *\n   * 与 isDark 配合使用，自动选择对应的浅色/深色面板配色。\n   * 可选值: \"qiuvision\" | \"github\" | \"one\" | \"dracula\" | \"nord\" | \"vitesse\" | \"monokai\"\n   */\n  colorTheme?: CodeBlockColorThemeName;\n  /** 子元素（通常为 CodeBlock 组件） */\n  children: React.ReactNode;\n  /** 额外的 CSS 类名 */\n  className?: string;\n}\n\n/**\n * 代码块外层容器面板\n *\n * 仿照 Tailwind CSS 官网的代码块风格，提供面板外壳、\n * 文件名标签、复制按钮等功能。搭配 CodeBlock 组件使用。\n *\n * 特性：\n * - **7 套内置配色主题**（与 CodeBlock 主题一一对应），各有浅色/深色变体\n * - 可选文件名标签（顶部左侧）\n * - **语言类型 fallback 标签**：未设置 filename 时，自动显示语言名称（如 \"TypeScript\"），视觉更平衡\n * - 可选复制按钮（顶部右侧），带复制成功动画反馈\n * - 自动重置内部 CodeBlock 的 margin / border / shadow\n *\n * @example\n * ```tsx\n * // 显示文件名标签\n * <CodeBlockPanel filename=\"app.tsx\" code={code} colorTheme=\"github\" isDark>\n *   <CodeBlock language=\"tsx\" colorTheme=\"github\" isDark>\n *     {code}\n *   </CodeBlock>\n * </CodeBlockPanel>\n *\n * // 不设置 filename，自动显示语言类型 \"TypeScript\" 作为 fallback 标签\n * <CodeBlockPanel language=\"typescript\" code={code} colorTheme=\"github\" isDark>\n *   <CodeBlock language=\"typescript\" colorTheme=\"github\" isDark>\n *     {code}\n *   </CodeBlock>\n * </CodeBlockPanel>\n *\n * // 关闭语言类型 fallback 标签\n * <CodeBlockPanel language=\"typescript\" showLanguageLabel={false} code={code}>\n *   <CodeBlock language=\"typescript\">{code}</CodeBlock>\n * </CodeBlockPanel>\n * ```\n */\nexport function CodeBlockPanel({\n  filename,\n  language,\n  showLanguageLabel = true,\n  code,\n  showCopyButton = true,\n  isDark = true,\n  colorTheme = \"qiuvision\",\n  children,\n  className,\n}: CodeBlockPanelProps) {\n  const [copied, setCopied] = useState(false);\n\n  const handleCopyToggle = useCallback(\n    async (newActive: boolean) => {\n      if (!newActive || !code) return;\n      try {\n        await navigator.clipboard.writeText(code);\n        setCopied(true);\n        setTimeout(() => setCopied(false), 2000);\n      } catch {\n        // 静默失败（如不支持 Clipboard API 时）\n      }\n    },\n    [code],\n  );\n\n  const hasCopyButton = showCopyButton && !!code;\n\n  // 当没有 filename 时，语言类型作为 fallback 标签\n  const languageLabel =\n    !filename && showLanguageLabel && language\n      ? getLanguageDisplayName(language)\n      : null;\n  const displayLabel = filename ?? languageLabel;\n  const hasHeader = !!displayLabel || hasCopyButton;\n\n  // 解析面板配色\n  const mode = isDark ? \"dark\" : \"light\";\n  const panelBg = PANEL_BG[colorTheme]?.[mode] ?? PANEL_BG.qiuvision[mode];\n  const text = PANEL_TEXT[mode];\n\n  return (\n    <div\n      className={cn(\"group/code-panel rounded-xl\", className)}\n      style={\n        {\n          backgroundColor: panelBg,\n          boxShadow: `inset 0 0 0 1px ${text.border}`,\n          \"--cbp-filename\": text.filename,\n          \"--cbp-btn\": text.btn,\n          \"--cbp-btn-hover\": text.btnHover,\n          \"--cbp-btn-hover-bg\": text.btnHoverBg,\n          \"--cbp-check\": text.check,\n        } as React.CSSProperties\n      }\n    >\n      {/* ---- 面板内容区域 ---- */}\n      <div className=\"rounded-xl p-1 text-sm\">\n        {/* ---- 头部：文件名 + 复制按钮 ---- */}\n        {hasHeader && (\n          <div className=\"flex items-center justify-between px-3 pt-0.5 pb-1\">\n            {displayLabel ? (\n              <span className=\"cbp-filename text-xs/5 font-medium select-none\">\n                {displayLabel}\n              </span>\n            ) : (\n              <span />\n            )}\n            {hasCopyButton && (\n              <DualStateToggle\n                active={copied}\n                onToggle={handleCopyToggle}\n                activeIcon={<Check className=\"cbp-check\" strokeWidth={2} />}\n                inactiveIcon={<Copy strokeWidth={1.5} />}\n                effect=\"scale\"\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"cbp-copy-btn size-7!\"\n                title=\"复制到剪贴板\"\n                activeLabel=\"已复制\"\n                inactiveLabel=\"复制到剪贴板\"\n                transitionDuration={0.2}\n              />\n            )}\n          </div>\n        )}\n        {/* ---- 代码内容容器 ---- */}\n        <div className=\"code-block-panel-content overflow-hidden rounded-lg\">\n          {children}\n        </div>\n      </div>\n\n      {/* Panel 配色样式（通过 CSS 变量驱动，自动去重） */}\n      <style jsx global>{`\n        .cbp-filename {\n          color: var(--cbp-filename);\n        }\n        .cbp-copy-btn {\n          color: var(--cbp-btn) !important;\n          transition: color 0.15s ease, background-color 0.15s ease;\n        }\n        .cbp-copy-btn:hover {\n          color: var(--cbp-btn-hover) !important;\n          background-color: var(--cbp-btn-hover-bg) !important;\n        }\n        .cbp-check {\n          color: var(--cbp-check);\n        }\n      `}</style>\n    </div>\n  );\n}\n"
    },
    {
      "type": "registry:component",
      "path": "components/qiuye-ui/code-block/code-block.tsx",
      "content": "\"use client\";\n\nimport React, { useState, useEffect, useRef, useCallback, useMemo } from \"react\";\nimport { Highlight, type PrismTheme } from \"prism-react-renderer\";\nimport { ChevronDown, ChevronUp } from \"lucide-react\";\nimport { AnimatePresence } from \"motion/react\";\n\nimport {\n  resolveCodeBlockTheme,\n  themeVarsToCSSProperties,\n  type CodeBlockColorThemeName,\n  type CodeBlockThemeConfig,\n} from \"./code-block-themes\";\n\n// ============================================\n// 公开导出（类型 + 工具）—— 从 code-block-themes 转导\n// ============================================\n\nexport type {\n  CodeBlockColorThemeName,\n  CodeBlockThemeConfig,\n  CodeBlockThemeVars,\n  SyntaxPalette,\n} from \"./code-block-themes\";\n\nexport {\n  codeBlockThemes,\n  CODE_BLOCK_COLOR_THEME_NAMES,\n  createCodeBlockThemeVars,\n  createSyntaxTheme,\n  deriveThemeFromPrism,\n  resolveCodeBlockTheme,\n  themeVarsToCSSProperties,\n} from \"./code-block-themes\";\n\n// ============================================\n// CodeBlock 组件\n// ============================================\n\n/**\n * 代码块显示模式\n * - \"collapse\": 展开/折叠模式，超出行数后显示渐变遮罩和展开按钮\n * - \"scroll\": 滚动模式，设置最大高度，超出部分纵向滚动\n * - \"auto-height\": 自适应高度模式，高度自动适配父容器，超出部分纵向滚动\n */\nexport type CodeBlockDisplayMode = \"collapse\" | \"scroll\" | \"auto-height\";\n\nexport interface CodeBlockProps {\n  /** 代码内容 */\n  children: string;\n  /** 编程语言（用于语法高亮） */\n  language?: string;\n  /** 是否为深色模式（控制内置主题的浅色/深色变体选择，默认 true） */\n  isDark?: boolean;\n  /**\n   * 内置配色主题名称（默认 \"qiuvision\"）\n   *\n   * 与 isDark 配合使用，自动选择对应的浅色/深色变体。\n   * 可选值: \"qiuvision\" | \"github\" | \"one\" | \"dracula\" | \"nord\" | \"vitesse\" | \"monokai\"\n   */\n  colorTheme?: CodeBlockColorThemeName;\n  /**\n   * 自定义主题配置（优先级高于 colorTheme 和 isDark）\n   *\n   * - 传入 CodeBlockThemeConfig：完整配置（语法高亮 + UI 配色）\n   * - 传入 PrismTheme：仅语法高亮，UI 配色自动从背景色推导\n   */\n  customTheme?: CodeBlockThemeConfig | PrismTheme;\n  /**\n   * 显示模式（溢出处理策略）\n   * - \"collapse\": 展开/折叠模式，超出行数后显示渐变遮罩和展开按钮\n   * - \"scroll\": 滚动模式，设置最大高度，超出部分纵向滚动\n   * - \"auto-height\": 自适应高度模式，高度自动适配父容器，超出部分纵向滚动\n   * \n   * 不设置时代码块无高度限制，完整显示所有代码\n   */\n  displayMode?: CodeBlockDisplayMode;\n  /** 折叠的行数阈值（displayMode=\"collapse\" 时生效，默认 15 行） */\n  maxLines?: number;\n  /**\n   * 最大高度（displayMode=\"scroll\" 时生效）\n   * \n   * 支持 CSS 单位字符串（如 \"400px\"、\"50vh\"、\"20rem\"）或数字（单位为 px）\n   * \n   * 默认 \"400px\"\n   */\n  maxHeight?: string | number;\n  /**\n   * 控制左侧行号的显示策略\n   *\n   * - `true`（默认）：始终显示行号\n   * - `false`：始终隐藏行号\n   * - `number`（如 `5`）：代码行数 >= 该值时才显示行号，否则隐藏\n   */\n  showLineNumbers?: boolean | number;\n  /** 是否在横向滚动时固定左侧行号列（sticky 效果），默认 true */\n  stickyLineNumbers?: boolean;\n  /** 是否在折叠后跳转时显示聚光灯阴影效果（displayMode=\"collapse\" 时生效），默认 true */\n  spotlightOnCollapse?: boolean;\n  /** 是否隐藏容器周围的 box-shadow 阴影（默认 false） */\n  noShadow?: boolean;\n  /** 额外的 CSS 类名 */\n  className?: string;\n}\n\n/**\n * 通用代码块显示组件\n *\n * 特性:\n * - 基于 prism-react-renderer 的语法高亮\n * - **可定制配色主题**：7 套内置主题（各有浅/深色变体）+ 自定义主题支持\n * - 行号显示 + 横向滚动时行号 sticky 固定\n * - 三种显示模式（通过 displayMode 切换）：\n *   - \"collapse\"：超出行数自动折叠，渐变遮罩 + 展开/收起按钮 + 聚光灯动画\n *   - \"scroll\"：设置最大高度，超出部分纵向滚动，带滚动阴影指示器\n *   - \"auto-height\"：自适应父容器高度，超出部分纵向滚动（适用于 flex/grid 布局）\n * - 自带完整样式，可独立于 MarkdownRenderer 使用\n *\n * @example\n * ```tsx\n * // 使用内置主题\n * <CodeBlock language=\"typescript\" colorTheme=\"github\" isDark={isDark}>\n *   {code}\n * </CodeBlock>\n *\n * // 使用自定义主题\n * <CodeBlock language=\"python\" customTheme={myThemeConfig}>\n *   {code}\n * </CodeBlock>\n * ```\n */\nexport function CodeBlock({\n  children,\n  language = \"plaintext\",\n  isDark = true,\n  colorTheme,\n  customTheme,\n  displayMode,\n  maxLines = 15,\n  maxHeight = \"400px\",\n  showLineNumbers = true,\n  stickyLineNumbers = true,\n  spotlightOnCollapse = true,\n  noShadow = false,\n  className = \"\",\n}: CodeBlockProps) {\n  const code = children.trim();\n\n  // ---- 主题解析 + CSS 变量 ----\n  const resolvedTheme = useMemo(\n    () => resolveCodeBlockTheme(colorTheme, customTheme, isDark),\n    [colorTheme, customTheme, isDark],\n  );\n\n  const cssVars = useMemo(\n    () => themeVarsToCSSProperties(resolvedTheme.vars),\n    [resolvedTheme.vars],\n  );\n\n  // ---- 模式判定 ----\n  const effectiveMode: CodeBlockDisplayMode | null = displayMode ?? null;\n\n  const lineCount = code.split(\"\\n\").length;\n\n  // ---- 行号显示策略 ----\n  const lineNumbersVisible =\n    showLineNumbers === true\n      ? true\n      : showLineNumbers === false\n        ? false\n        : lineCount >= showLineNumbers;\n\n  // ---- Collapse 模式状态 ----\n  const [isExpanded, setIsExpanded] = useState(false);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const cleanupRef = useRef<(() => void) | null>(null);\n  const COLLAPSE_BUFFER = 3;\n  const shouldCollapse =\n    effectiveMode === \"collapse\" && lineCount > maxLines + COLLAPSE_BUFFER;\n\n  // ---- Scroll / Auto-height 模式状态 ----\n  const isScrollable =\n    effectiveMode === \"scroll\" || effectiveMode === \"auto-height\";\n  const scrollContentRef = useRef<HTMLDivElement>(null);\n  const [scrollShadow, setScrollShadow] = useState({\n    top: false,\n    bottom: false,\n  });\n\n  // 解析 maxHeight（支持 number 和 string）\n  const resolvedMaxHeight =\n    typeof maxHeight === \"number\" ? `${maxHeight}px` : maxHeight;\n\n  // 组件卸载时确保清理 spotlight 状态，防止导航离开后 bottomFade 遮罩未恢复\n  useEffect(() => {\n    return () => {\n      cleanupRef.current?.();\n    };\n  }, []);\n\n  // Scroll shadow 检测（scroll / auto-height 模式）\n  useEffect(() => {\n    if (!isScrollable) return;\n    const el = scrollContentRef.current;\n    if (!el) return;\n\n    const update = () => {\n      const { scrollTop, scrollHeight, clientHeight } = el;\n      setScrollShadow({\n        top: scrollTop > 2,\n        bottom: scrollTop + clientHeight < scrollHeight - 2,\n      });\n    };\n\n    update();\n    el.addEventListener(\"scroll\", update, { passive: true });\n    const ro = new ResizeObserver(update);\n    ro.observe(el);\n\n    return () => {\n      el.removeEventListener(\"scroll\", update);\n      ro.disconnect();\n    };\n  }, [isScrollable]);\n\n  // 收起代码块时的处理：滚动到代码块位置 + 聚光灯强调动画（可配置）\n  const handleCollapse = useCallback(() => {\n    setIsExpanded(false);\n    requestAnimationFrame(() => {\n      if (wrapperRef.current) {\n        // 导航栏高度补偿 + 灵动岛高度 + 额外空间\n        const offset = 142;\n        const elementPosition =\n          wrapperRef.current.getBoundingClientRect().top;\n        const currentScroll = window.scrollY || window.pageYOffset;\n        const targetPosition = elementPosition + currentScroll - offset;\n\n        window.scrollTo({\n          top: targetPosition,\n        });\n\n        // 聚光灯效果：暗化代码块之外的页面内容，强调当前代码块位置\n        if (spotlightOnCollapse) {\n          const el = wrapperRef.current;\n          // 暂时隐藏视口底部的渐变遮罩，避免其覆盖在聚光灯阴影上方\n          const bottomFade = document.querySelector(\n            \"[data-bottom-fade]\",\n          ) as HTMLElement | null;\n          requestAnimationFrame(() => {\n            el.classList.add(\"spotlight-highlight\");\n            if (bottomFade) {\n              bottomFade.style.transition = \"opacity 0.25s ease-out\";\n              bottomFade.style.opacity = \"0\";\n            }\n            const onEnd = () => {\n              el.classList.remove(\"spotlight-highlight\");\n              el.removeEventListener(\"animationend\", onEnd);\n              cleanupRef.current = null;\n              // 恢复底部渐变遮罩\n              if (bottomFade) {\n                bottomFade.style.transition = \"opacity 0.8s ease-out\";\n                bottomFade.style.opacity = \"\";\n              }\n            };\n            el.addEventListener(\"animationend\", onEnd);\n            // 注册 cleanup 供组件卸载时调用，确保即使动画未结束也能恢复状态\n            cleanupRef.current = () => {\n              el.classList.remove(\"spotlight-highlight\");\n              el.removeEventListener(\"animationend\", onEnd);\n              if (bottomFade) {\n                bottomFade.style.transition = \"\";\n                bottomFade.style.opacity = \"\";\n              }\n            };\n          });\n        }\n      }\n    });\n  }, [spotlightOnCollapse]);\n\n  // 语法高亮渲染\n  const highlightedCode = (\n    <Highlight theme={resolvedTheme.syntax} code={code} language={language}>\n      {({\n        className: hlClassName,\n        style,\n        tokens,\n        getLineProps,\n        getTokenProps,\n      }) => (\n        <pre className={hlClassName} style={style}>\n          <code>\n            {tokens.map((line, i) => (\n              <div key={i} {...getLineProps({ line })}>\n                <span className=\"line-number\">{i + 1}</span>\n                <span className=\"line-content\">\n                  {line.map((token, key) => (\n                    <span key={key} {...getTokenProps({ token })} />\n                  ))}\n                </span>\n              </div>\n            ))}\n          </code>\n        </pre>\n      )}\n    </Highlight>\n  );\n\n  const modeClass =\n    effectiveMode === \"auto-height\"\n      ? \" auto-height-mode\"\n      : effectiveMode === \"scroll\"\n        ? \" scroll-mode\"\n        : \"\";\n  const wrapperClass = `qiuye-code-block${lineNumbersVisible ? \"\" : \" hide-line-numbers\"}${stickyLineNumbers && lineNumbersVisible ? \" sticky-line-numbers\" : \"\"}${noShadow ? \" no-shadow\" : \"\"}${modeClass}${className ? ` ${className}` : \"\"}`;\n\n  // ---- 普通模式（无显示模式，或 collapse 模式但行数不够触发折叠） ----\n  if (!effectiveMode || (effectiveMode === \"collapse\" && !shouldCollapse)) {\n    return (\n      <div\n        className={wrapperClass}\n        style={cssVars as React.CSSProperties}\n      >\n        {highlightedCode}\n        <CodeBlockStyles />\n      </div>\n    );\n  }\n\n  // ---- Collapse 展开/折叠模式 ----\n  if (effectiveMode === \"collapse\" && shouldCollapse) {\n    // 折叠高度计算：pre padding-top(0.5rem) + maxLines × 行高(0.875rem × 1.6 = 1.4rem)\n    const collapsedMaxHeight = `${0.5 + maxLines * 1.4}rem`;\n\n    return (\n      <div\n        className={wrapperClass}\n        style={cssVars as React.CSSProperties}\n      >\n        <div\n          ref={wrapperRef}\n          className={`collapsible-code-block ${isExpanded ? \"is-expanded\" : \"is-collapsed\"}`}\n        >\n          <div\n            className=\"collapsible-code-content\"\n            style={\n              !isExpanded\n                ? { maxHeight: collapsedMaxHeight, overflow: \"hidden\" }\n                : undefined\n            }\n          >\n            {highlightedCode}\n          </div>\n\n          {/* 折叠状态：渐变遮罩 + 展开按钮 */}\n          <AnimatePresence>\n            {!isExpanded && (\n              <div key=\"collapsed\" className=\"collapsible-code-overlay\">\n                <button\n                  className=\"collapsible-code-btn\"\n                  onClick={() => setIsExpanded(true)}\n                >\n                  <ChevronDown className=\"h-3.5 w-3.5 -ml-1\" />\n                  展开全部 {lineCount} 行\n                </button>\n              </div>\n            )}\n          </AnimatePresence>\n\n          {/* 展开状态：悬浮在底部的圆形收起按钮 */}\n          <AnimatePresence>\n            {isExpanded && (\n              <button\n                key=\"collapse-btn\"\n                className=\"collapsible-code-collapse-btn\"\n                onClick={handleCollapse}\n              >\n                <ChevronUp className=\"h-3.5 w-3.5\" />\n              </button>\n            )}\n          </AnimatePresence>\n        </div>\n        <CodeBlockStyles />\n      </div>\n    );\n  }\n\n  // ---- Scroll / Auto-height 滚动模式 ----\n  if (isScrollable) {\n    return (\n      <div\n        className={wrapperClass}\n        style={cssVars as React.CSSProperties}\n      >\n        <div className=\"scrollable-code-block\">\n          <div\n            ref={scrollContentRef}\n            className=\"scrollable-code-content\"\n            style={\n              effectiveMode === \"scroll\"\n                ? { maxHeight: resolvedMaxHeight }\n                : undefined\n            }\n          >\n            {highlightedCode}\n          </div>\n          {/* 滚动阴影指示器 - 提示上方/下方还有更多内容 */}\n          <div\n            className={`scroll-shadow scroll-shadow-top${scrollShadow.top ? \" visible\" : \"\"}`}\n          />\n          <div\n            className={`scroll-shadow scroll-shadow-bottom${scrollShadow.bottom ? \" visible\" : \"\"}`}\n          />\n        </div>\n        <CodeBlockStyles />\n      </div>\n    );\n  }\n\n  // Fallback\n  return (\n    <div\n      className={wrapperClass}\n      style={cssVars as React.CSSProperties}\n    >\n      {highlightedCode}\n      <CodeBlockStyles />\n    </div>\n  );\n}\n\n// ============================================\n// 样式组件（styled-jsx global，自动去重）\n// 所有配色通过 CSS 自定义属性（--cb-xxx）驱动，\n// 无需 .dark 前缀重复，同一份 CSS 适配任意主题。\n// ============================================\n\nfunction CodeBlockStyles() {\n  return (\n    <style jsx global>{`\n      /* ============================================\n         代码块基础样式\n         ============================================ */\n\n      .qiuye-code-block pre {\n        margin: 2rem 0;\n        padding: 0.5rem 0.5rem 0.5rem 0;\n        border-radius: 8px;\n        overflow-x: auto;\n        font-size: 0.875rem;\n        line-height: 1.6;\n        box-shadow: 0 4px 12px var(--cb-shadow-lg);\n        border: 1px solid var(--cb-border);\n        scrollbar-width: thin;\n        scrollbar-color: var(--cb-sb-thumb) var(--cb-sb-track);\n        overscroll-behavior-x: none;\n      }\n\n      .qiuye-code-block pre code {\n        font-family:\n          \"Fira Code\", \"Monaco\", \"Menlo\", \"Ubuntu Mono\", \"Consolas\",\n          \"source-code-pro\", monospace;\n        font-size: 0.875rem;\n        line-height: 1.6;\n        display: block;\n        width: fit-content;\n        min-width: 100%;\n      }\n\n      /* 代码行容器 */\n      .qiuye-code-block pre code > div {\n        display: flex;\n        align-items: flex-start;\n        min-height: 1.6em;\n        padding: 0 0.5rem;\n        margin: 0 -0.5rem;\n        border-radius: 4px;\n      }\n\n      /* 代码行悬停效果 */\n      .qiuye-code-block pre code > div:hover {\n        background-color: var(--cb-hover);\n      }\n\n      /* ============================================\n         行号样式\n         ============================================ */\n\n      .qiuye-code-block .line-number {\n        display: inline-block;\n        width: 3rem;\n        min-width: 3rem;\n        padding-right: 1rem;\n        margin-right: 1rem;\n        text-align: right;\n        color: var(--cb-ln-color);\n        user-select: none;\n        border-right: 1px solid var(--cb-ln-border);\n        flex-shrink: 0;\n      }\n\n      /* 行内容 */\n      .qiuye-code-block .line-content {\n        flex: 1;\n        white-space: pre;\n      }\n\n      /* ============================================\n         响应式优化\n         ============================================ */\n\n      @media (max-width: 640px) {\n        .qiuye-code-block pre {\n          margin: 1.5rem 0;\n          border-radius: 6px;\n          font-size: 0.8rem;\n          padding: 0.5rem 0.5rem 0.5rem 0;\n        }\n\n        .qiuye-code-block .line-number {\n          width: 2.5rem;\n          min-width: 2.5rem;\n          padding-right: 0.75rem;\n          margin-right: 0.75rem;\n          font-size: 0.8rem;\n        }\n\n        .qiuye-code-block pre code {\n          font-size: 0.8rem;\n        }\n      }\n\n      /* ============================================\n         滚动条美化 - Webkit\n         ============================================ */\n\n      .qiuye-code-block pre::-webkit-scrollbar {\n        height: 10px;\n      }\n\n      .qiuye-code-block pre::-webkit-scrollbar-track {\n        background: var(--cb-sb-track);\n        border-radius: 5px;\n      }\n\n      .qiuye-code-block pre::-webkit-scrollbar-thumb {\n        background: var(--cb-sb-thumb);\n        border-radius: 5px;\n        transition: background 0.2s ease;\n      }\n\n      .qiuye-code-block pre::-webkit-scrollbar-thumb:hover {\n        background: var(--cb-sb-thumb-hover);\n      }\n\n      /* ============================================\n         可折叠代码块样式\n         ============================================ */\n\n      /* 容器 - 接管 pre 的外层样式 */\n      .qiuye-code-block .collapsible-code-block {\n        position: relative;\n        margin: 2rem 0;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px var(--cb-shadow-lg);\n        overflow: hidden;\n        border: 1px solid var(--cb-border);\n      }\n\n      /* 展开时允许收起按钮突出边框 */\n      .qiuye-code-block .collapsible-code-block.is-expanded {\n        overflow: visible;\n      }\n\n      /* 内容区域接管圆角裁剪（展开时 block overflow: visible，由 content 裁剪背景） */\n      .qiuye-code-block .collapsible-code-block .collapsible-code-content {\n        overflow: hidden;\n        border-radius: inherit;\n      }\n\n      /* 内部 pre 取消自身外层样式（由 wrapper 统一处理） */\n      .qiuye-code-block .collapsible-code-block .collapsible-code-content pre {\n        margin: 0;\n        border: none;\n        border-radius: 0;\n        box-shadow: none;\n      }\n\n      /* 渐变遮罩层 */\n      .qiuye-code-block .collapsible-code-overlay {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 80px;\n        display: flex;\n        align-items: flex-end;\n        justify-content: center;\n        padding-bottom: 12px;\n        pointer-events: none;\n        z-index: 1;\n        background: linear-gradient(\n          to bottom,\n          rgba(var(--cb-bg-rgb), 0) 0%,\n          rgba(var(--cb-bg-rgb), 0.7) 40%,\n          rgba(var(--cb-bg-rgb), 0.95) 80%,\n          rgba(var(--cb-bg-rgb), 1) 100%\n        );\n      }\n\n      /* 展开按钮 */\n      .qiuye-code-block .collapsible-code-btn {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        padding: 6px 16px;\n        border-radius: 999px;\n        font-size: 0.75rem;\n        font-weight: 500;\n        cursor: pointer;\n        pointer-events: all;\n        transition: all 0.2s ease;\n        font-family:\n          \"Inter\",\n          -apple-system,\n          sans-serif;\n        background: rgba(var(--cb-bg-rgb), 0.9);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        border: 1px solid var(--cb-btn-border);\n        color: var(--cb-btn-text);\n        box-shadow: 0 2px 8px var(--cb-shadow);\n      }\n\n      .qiuye-code-block .collapsible-code-btn:hover {\n        color: var(--cb-btn-hover-text);\n        border-color: var(--cb-btn-hover-border);\n        box-shadow: 0 2px 12px var(--cb-shadow-lg);\n      }\n\n      /* 悬浮收起按钮 - 圆形，位于右下角 */\n      .qiuye-code-block .collapsible-code-collapse-btn {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        transform: translate(-12px, -12px);\n        z-index: 2;\n        width: 32px;\n        height: 32px;\n        opacity: 0.85;\n        padding: 0;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: rgba(var(--cb-bg-rgb), 0.95);\n        backdrop-filter: blur(8px);\n        -webkit-backdrop-filter: blur(8px);\n        border: 1px solid var(--cb-btn-border);\n        color: var(--cb-btn-text);\n        box-shadow: 0 2px 8px var(--cb-shadow);\n      }\n\n      .qiuye-code-block .collapsible-code-collapse-btn:hover {\n        color: var(--cb-btn-hover-text);\n        border-color: var(--cb-btn-hover-border);\n        box-shadow: 0 2px 12px var(--cb-shadow-lg);\n        opacity: 1;\n      }\n\n      /* 收起后聚光灯强调动画 —— 通过超大 box-shadow 暗化代码块之外的区域 */\n      @keyframes code-block-spotlight {\n        0% {\n          box-shadow: 0 4px 12px var(--cb-shadow-lg), 0 0 0 9999px transparent;\n        }\n        15%, 50% {\n          box-shadow: 0 4px 12px var(--cb-shadow-lg), 0 0 0 9999px var(--cb-spotlight);\n        }\n        100% {\n          box-shadow: 0 4px 12px var(--cb-shadow-lg), 0 0 0 9999px transparent;\n        }\n      }\n      .qiuye-code-block .collapsible-code-block.spotlight-highlight {\n        z-index: 30;\n        animation: code-block-spotlight 1.4s ease-in-out;\n      }\n\n      /* 可折叠代码块 - 移动端响应式 */\n      @media (max-width: 640px) {\n        .qiuye-code-block .collapsible-code-block {\n          margin: 1.5rem 0;\n          border-radius: 6px;\n        }\n      }\n\n      /* ============================================\n         滚动模式 (scroll + auto-height) 代码块样式\n         ============================================ */\n\n      /* 容器 - 接管 pre 的外层样式（与 collapsible-code-block 类似） */\n      .qiuye-code-block .scrollable-code-block {\n        position: relative;\n        margin: 2rem 0;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px var(--cb-shadow-lg);\n        overflow: hidden;\n        border: 1px solid var(--cb-border);\n        background: var(--cb-bg);\n      }\n\n      /* 内部可滚动区域 - 纵向 + 横向均可滚动 */\n      .qiuye-code-block .scrollable-code-block .scrollable-code-content {\n        overflow: auto;\n        scrollbar-width: thin;\n        scrollbar-color: var(--cb-sb-thumb) var(--cb-sb-track);\n        overscroll-behavior-x: none;\n      }\n\n      /* 内部 pre 取消自身外层样式（由 wrapper 统一处理），并取消 overflow 交给父容器 */\n      .qiuye-code-block .scrollable-code-block pre {\n        margin: 0;\n        border: none;\n        border-radius: 0;\n        box-shadow: none;\n        overflow: visible;\n      }\n\n      /* Webkit 滚动条美化 - 可滚动代码内容区 */\n      .qiuye-code-block .scrollable-code-content::-webkit-scrollbar {\n        width: 10px;\n        height: 10px;\n      }\n\n      .qiuye-code-block .scrollable-code-content::-webkit-scrollbar-track {\n        background: var(--cb-sb-track);\n      }\n\n      .qiuye-code-block .scrollable-code-content::-webkit-scrollbar-thumb {\n        background: var(--cb-sb-thumb);\n        border-radius: 5px;\n        transition: background 0.2s ease;\n      }\n\n      .qiuye-code-block .scrollable-code-content::-webkit-scrollbar-thumb:hover {\n        background: var(--cb-sb-thumb-hover);\n      }\n\n      .qiuye-code-block .scrollable-code-content::-webkit-scrollbar-corner {\n        background: var(--cb-sb-track);\n      }\n\n      /* ---- 滚动阴影指示器 ---- */\n      .qiuye-code-block .scroll-shadow {\n        position: absolute;\n        left: 0;\n        right: 0;\n        height: 24px;\n        pointer-events: none;\n        z-index: 2;\n        opacity: 0;\n        transition: opacity 0.25s ease;\n      }\n\n      .qiuye-code-block .scroll-shadow.visible {\n        opacity: 1;\n      }\n\n      .qiuye-code-block .scroll-shadow-top {\n        top: 0;\n        background: linear-gradient(\n          to bottom,\n          rgba(var(--cb-bg-rgb), 0.75) 0%,\n          transparent 100%\n        );\n        border-radius: 8px 8px 0 0;\n      }\n\n      .qiuye-code-block .scroll-shadow-bottom {\n        bottom: 0;\n        background: linear-gradient(\n          to top,\n          rgba(var(--cb-bg-rgb), 0.75) 0%,\n          transparent 100%\n        );\n        border-radius: 0 0 8px 8px;\n      }\n\n      /* ---- Auto-height 模式 - 自适应父容器高度 ---- */\n      .qiuye-code-block.auto-height-mode {\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .qiuye-code-block.auto-height-mode .scrollable-code-block {\n        flex: 1;\n        min-height: 0;\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .qiuye-code-block.auto-height-mode .scrollable-code-content {\n        flex: 1;\n        min-height: 0;\n      }\n\n      /* 滚动模式 - 移动端响应式 */\n      @media (max-width: 640px) {\n        .qiuye-code-block .scrollable-code-block {\n          margin: 1.5rem 0;\n          border-radius: 6px;\n        }\n\n        .qiuye-code-block .scroll-shadow-top {\n          border-radius: 6px 6px 0 0;\n        }\n\n        .qiuye-code-block .scroll-shadow-bottom {\n          border-radius: 0 0 6px 6px;\n        }\n      }\n\n      /* ============================================\n         Sticky 行号 - 横向滚动时固定左侧行号列\n         ============================================ */\n\n      .qiuye-code-block.sticky-line-numbers .line-number {\n        position: sticky;\n        left: 0;\n        z-index: 1;\n        background-color: var(--cb-bg);\n      }\n\n      .qiuye-code-block.sticky-line-numbers pre code > div:hover .line-number {\n        background-color: var(--cb-hover-solid);\n      }\n\n      /* ============================================\n         隐藏行号模式 - 不显示左侧行号列\n         ============================================ */\n\n      .qiuye-code-block.hide-line-numbers .line-number {\n        display: none;\n      }\n\n      .qiuye-code-block.hide-line-numbers pre {\n        padding-left: 1rem;\n      }\n\n      .qiuye-code-block.hide-line-numbers .collapsible-code-block pre,\n      .qiuye-code-block.hide-line-numbers .scrollable-code-block pre {\n        padding-left: 1rem;\n      }\n\n      /* ============================================\n         No shadow 模式 - 隐藏容器阴影\n         ============================================ */\n\n      .qiuye-code-block.no-shadow pre,\n      .qiuye-code-block.no-shadow .collapsible-code-block,\n      .qiuye-code-block.no-shadow .scrollable-code-block {\n        box-shadow: none;\n      }\n\n      /* ============================================\n         CodeBlockPanel 嵌入模式\n         在 CodeBlockPanel 内部时，重置 CodeBlock 的\n         外层装饰样式（margin / border / radius / shadow），\n         由 Panel 统一控制外观。\n         ============================================ */\n\n      .code-block-panel-content .qiuye-code-block pre,\n      .code-block-panel-content .qiuye-code-block .collapsible-code-block,\n      .code-block-panel-content .qiuye-code-block .scrollable-code-block {\n        margin: 0;\n        border: none;\n        border-radius: 0;\n        box-shadow: none;\n      }\n    `}</style>\n  );\n}\n"
    },
    {
      "type": "registry:component",
      "path": "components/qiuye-ui/code-block/code-block-themes.ts",
      "content": "import type { PrismTheme } from \"prism-react-renderer\";\n\n// ============================================\n// 类型定义\n// ============================================\n\n/** 内置配色主题名称 */\nexport type CodeBlockColorThemeName =\n  | \"qiuvision\"\n  | \"github\"\n  | \"one\"\n  | \"dracula\"\n  | \"nord\"\n  | \"vitesse\"\n  | \"monokai\";\n\n/** 所有内置配色主题名称（可用于遍历 / 展示列表） */\nexport const CODE_BLOCK_COLOR_THEME_NAMES: readonly CodeBlockColorThemeName[] = [\n  \"qiuvision\",\n  \"github\",\n  \"one\",\n  \"dracula\",\n  \"nord\",\n  \"vitesse\",\n  \"monokai\",\n] as const;\n\n/**\n * UI 配色变量（对应 CSS 自定义属性 --cb-xxx）\n *\n * 这些变量控制代码块的所有 UI 元素配色：\n * 边框、行号、滚动条、按钮、遮罩层、聚光灯等。\n * 语法高亮色由 PrismTheme 单独控制。\n */\nexport interface CodeBlockThemeVars {\n  /** 代码背景色（hex，如 \"#1A1A1A\"） */\n  bg: string;\n  /** 背景色 RGB 分量（如 \"26, 26, 26\"，用于 rgba() 透明度混合） */\n  bgRgb: string;\n  /** 边框色 */\n  border: string;\n  /** 行悬停背景色（半透明） */\n  hover: string;\n  /** 行号悬停背景色（不透明，用于 sticky 行号覆盖） */\n  hoverSolid: string;\n  /** 行号文本色 */\n  lnColor: string;\n  /** 行号分隔线色 */\n  lnBorder: string;\n  /** 滚动条滑块色 */\n  sbThumb: string;\n  /** 滚动条滑块悬停色 */\n  sbThumbHover: string;\n  /** 滚动条轨道色 */\n  sbTrack: string;\n  /** 按钮文本色 */\n  btnText: string;\n  /** 按钮边框色 */\n  btnBorder: string;\n  /** 按钮悬停文本色 */\n  btnHoverText: string;\n  /** 按钮悬停边框色 */\n  btnHoverBorder: string;\n  /** 聚光灯遮罩色（含 alpha，如 \"rgba(0,0,0,0.65)\"） */\n  spotlight: string;\n  /** 阴影色（用于按钮等小元素 box-shadow） */\n  shadow: string;\n  /** 阴影色 - 加强（用于容器和悬停 box-shadow） */\n  shadowLg: string;\n}\n\n/**\n * 完整代码块主题配置\n *\n * 包含语法高亮（PrismTheme）+ UI 配色变量。\n * 可通过 `createCodeBlockThemeVars` 或 `createSyntaxTheme` 快速创建。\n */\nexport interface CodeBlockThemeConfig {\n  /** 语法高亮主题（传递给 prism-react-renderer） */\n  syntax: PrismTheme;\n  /** UI 配色变量（映射到 CSS 自定义属性） */\n  vars: CodeBlockThemeVars;\n}\n\n/**\n * 语法高亮色板（简化参数，用于快速创建 PrismTheme）\n *\n * 通过 `createSyntaxTheme(palette)` 生成完整 PrismTheme。\n */\nexport interface SyntaxPalette {\n  /** 代码背景色 */\n  bg: string;\n  /** 代码前景色（默认文本色） */\n  fg: string;\n  /** 注释色 */\n  comment: string;\n  /** 字符串色 */\n  string: string;\n  /** 运算符 / 标点色 */\n  operator: string;\n  /** 数值、布尔值、变量、属性等 */\n  number: string;\n  /** 关键字、标签、选择器 */\n  keyword: string;\n  /** 函数名 */\n  function: string;\n  /** 类名、内建类型、常量 */\n  class: string;\n  /** 属性名、@ 规则（默认取 string 色） */\n  attr?: string;\n}\n\n// ============================================\n// 内部工具函数\n// ============================================\n\n/** Hex 颜色 → RGB 分量 */\nfunction hexToRgb(hex: string): [number, number, number] {\n  const h = hex.replace(\"#\", \"\");\n  return [\n    parseInt(h.slice(0, 2), 16),\n    parseInt(h.slice(2, 4), 16),\n    parseInt(h.slice(4, 6), 16),\n  ];\n}\n\n/** Hex + alpha → RGBA 字符串 */\nfunction hexToRgba(hex: string, alpha: number): string {\n  const [r, g, b] = hexToRgb(hex);\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n}\n\n/** 将 fg 以 alpha 叠加到 bg 上，返回不透明 hex */\nfunction blendColors(bgHex: string, fgHex: string, alpha: number): string {\n  const [br, bg, bb] = hexToRgb(bgHex);\n  const [fr, fg, fb] = hexToRgb(fgHex);\n  const r = Math.round(fr * alpha + br * (1 - alpha));\n  const g = Math.round(fg * alpha + bg * (1 - alpha));\n  const b = Math.round(fb * alpha + bb * (1 - alpha));\n  return `#${r.toString(16).padStart(2, \"0\")}${g.toString(16).padStart(2, \"0\")}${b.toString(16).padStart(2, \"0\")}`;\n}\n\n// ============================================\n// 公开工具函数\n// ============================================\n\n/**\n * 从 4 个关键色 + 明暗标志创建完整 UI 配色变量\n *\n * @example\n * ```ts\n * const vars = createCodeBlockThemeVars({\n *   bg: \"#1A1A1A\",\n *   fg: \"#ECECEC\",\n *   accent: \"#D6C8A6\",   // 强调色（影响滚动条、悬停边框等）\n *   muted: \"#9FA3A8\",    // 次级色（影响行号、按钮文字等）\n *   isDark: true,\n * });\n * ```\n */\nexport function createCodeBlockThemeVars(opts: {\n  /** 背景色 (hex) */\n  bg: string;\n  /** 前景色 (hex) */\n  fg: string;\n  /** 强调色 (hex)，影响滚动条滑块、悬停边框、行悬停背景等 */\n  accent: string;\n  /** 次级色 (hex)，影响行号文字、按钮文字等 */\n  muted: string;\n  /** 是否深色模式（影响各透明度系数） */\n  isDark: boolean;\n}): CodeBlockThemeVars {\n  const { bg, fg, accent, muted, isDark } = opts;\n  const [bgR, bgG, bgB] = hexToRgb(bg);\n  return {\n    bg,\n    bgRgb: `${bgR}, ${bgG}, ${bgB}`,\n    border: isDark ? hexToRgba(accent, 0.2) : hexToRgba(fg, 0.1),\n    hover: hexToRgba(accent, isDark ? 0.08 : 0.06),\n    hoverSolid: blendColors(bg, accent, isDark ? 0.08 : 0.06),\n    lnColor: hexToRgba(muted, isDark ? 0.5 : 0.65),\n    lnBorder: hexToRgba(fg, isDark ? 0.1 : 0.15),\n    sbThumb: hexToRgba(accent, isDark ? 0.3 : 0.4),\n    sbThumbHover: hexToRgba(accent, isDark ? 0.5 : 0.6),\n    sbTrack: hexToRgba(isDark ? \"#FFFFFF\" : fg, 0.05),\n    btnText: hexToRgba(isDark ? muted : fg, isDark ? 0.7 : 0.55),\n    btnBorder: hexToRgba(isDark ? accent : fg, isDark ? 0.15 : 0.12),\n    btnHoverText: hexToRgba(fg, 0.85),\n    btnHoverBorder: hexToRgba(accent, isDark ? 0.35 : 0.3),\n    spotlight: hexToRgba(\"#000000\", isDark ? 0.65 : 0.25),\n    shadow: hexToRgba(\"#000000\", isDark ? 0.15 : 0.06),\n    shadowLg: hexToRgba(\"#000000\", isDark ? 0.25 : 0.12),\n  };\n}\n\n/**\n * 从色板快速创建 PrismTheme\n *\n * @example\n * ```ts\n * const theme = createSyntaxTheme({\n *   bg: \"#282c34\", fg: \"#abb2bf\",\n *   comment: \"#5c6370\", string: \"#98c379\",\n *   operator: \"#abb2bf\", number: \"#d19a66\",\n *   keyword: \"#c678dd\", function: \"#61afef\",\n *   class: \"#e5c07b\",\n * });\n * ```\n */\nexport function createSyntaxTheme(palette: SyntaxPalette): PrismTheme {\n  return {\n    plain: {\n      color: palette.fg,\n      backgroundColor: palette.bg,\n    },\n    styles: [\n      {\n        types: [\"comment\", \"prolog\", \"doctype\", \"cdata\"],\n        style: { color: palette.comment, fontStyle: \"italic\" as const },\n      },\n      { types: [\"namespace\"], style: { opacity: 0.7 } },\n      {\n        types: [\"string\", \"attr-value\"],\n        style: { color: palette.string },\n      },\n      {\n        types: [\"punctuation\", \"operator\"],\n        style: { color: palette.operator },\n      },\n      {\n        types: [\n          \"entity\",\n          \"url\",\n          \"symbol\",\n          \"number\",\n          \"boolean\",\n          \"variable\",\n          \"property\",\n          \"regex\",\n          \"inserted\",\n          \"function-variable\",\n        ],\n        style: { color: palette.number },\n      },\n      {\n        types: [\"atrule\", \"attr-name\"],\n        style: { color: palette.attr || palette.string },\n      },\n      {\n        types: [\"keyword\", \"tag\", \"selector\"],\n        style: { color: palette.keyword },\n      },\n      {\n        types: [\"function\", \"deleted\"],\n        style: { color: palette.function },\n      },\n      {\n        types: [\"builtin\", \"char\", \"constant\", \"class-name\"],\n        style: { color: palette.class },\n      },\n    ],\n  };\n}\n\n/**\n * 从 PrismTheme 自动推导完整主题配置\n *\n * 自动检测背景明暗，从语法样式中提取强调色和次级色。\n * 适用于只有 PrismTheme 时快速生成完整配置。\n *\n * @param prismTheme - 已有的 PrismTheme 对象\n * @param isDark - 明暗模式（不传时自动检测）\n */\nexport function deriveThemeFromPrism(\n  prismTheme: PrismTheme,\n  isDark?: boolean,\n): CodeBlockThemeConfig {\n  const bg = prismTheme.plain.backgroundColor || \"#1A1A1A\";\n  const fg = prismTheme.plain.color || \"#ECECEC\";\n\n  // 自动检测背景明暗\n  const [r, g, b] = hexToRgb(bg);\n  const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n  const detectedIsDark = isDark ?? luminance < 0.5;\n\n  // 从语法样式中提取关键色\n  let accent = detectedIsDark ? \"#7CA7FF\" : \"#4785CC\";\n  let muted = detectedIsDark ? \"#9FA3A8\" : \"#8B8B8B\";\n\n  for (const s of prismTheme.styles) {\n    if (s.types.includes(\"keyword\") && s.style.color) {\n      accent = s.style.color;\n    }\n    if (s.types.includes(\"comment\") && s.style.color) {\n      muted = s.style.color;\n    }\n  }\n\n  return {\n    syntax: prismTheme,\n    vars: createCodeBlockThemeVars({\n      bg,\n      fg,\n      accent,\n      muted,\n      isDark: detectedIsDark,\n    }),\n  };\n}\n\n// ============================================\n// 内置主题定义\n// ============================================\n\n// ---- QiuVision（品牌默认主题） ----\n\nconst qiuvisionDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#1A1A1A\",\n    fg: \"#ECECEC\",\n    comment: \"#9FA3A8\",\n    string: \"#D6C8A6\",\n    operator: \"#ECECEC\",\n    number: \"#7CA7FF\",\n    keyword: \"#FF92DF\",\n    function: \"#FFB86C\",\n    class: \"#FFB86C\",\n    attr: \"#D6C8A6\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#1A1A1A\",\n    fg: \"#ECECEC\",\n    accent: \"#D6C8A6\",\n    muted: \"#9FA3A8\",\n    isDark: true,\n  }),\n};\n\nconst qiuvisionLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#FAFAFA\",\n    fg: \"#1F1F1F\",\n    comment: \"#8B8B8B\",\n    string: \"#A07A44\",\n    operator: \"#393939\",\n    number: \"#4785CC\",\n    keyword: \"#C44BB0\",\n    function: \"#D97519\",\n    class: \"#D97519\",\n    attr: \"#A07A44\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#FAFAFA\",\n    fg: \"#1F1F1F\",\n    accent: \"#A07A44\",\n    muted: \"#8B8B8B\",\n    isDark: false,\n  }),\n};\n\n// ---- GitHub ----\n\nconst githubDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#0d1117\",\n    fg: \"#e6edf3\",\n    comment: \"#8b949e\",\n    string: \"#a5d6ff\",\n    operator: \"#e6edf3\",\n    number: \"#79c0ff\",\n    keyword: \"#ff7b72\",\n    function: \"#d2a8ff\",\n    class: \"#ffa657\",\n    attr: \"#79c0ff\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#0d1117\",\n    fg: \"#e6edf3\",\n    accent: \"#58a6ff\",\n    muted: \"#8b949e\",\n    isDark: true,\n  }),\n};\n\nconst githubLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#ffffff\",\n    fg: \"#24292f\",\n    comment: \"#6e7781\",\n    string: \"#0a3069\",\n    operator: \"#24292f\",\n    number: \"#0550ae\",\n    keyword: \"#cf222e\",\n    function: \"#8250df\",\n    class: \"#953800\",\n    attr: \"#0550ae\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#ffffff\",\n    fg: \"#24292f\",\n    accent: \"#0969da\",\n    muted: \"#6e7781\",\n    isDark: false,\n  }),\n};\n\n// ---- One (Atom One Dark / Light) ----\n\nconst oneDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#282c34\",\n    fg: \"#abb2bf\",\n    comment: \"#5c6370\",\n    string: \"#98c379\",\n    operator: \"#abb2bf\",\n    number: \"#d19a66\",\n    keyword: \"#c678dd\",\n    function: \"#61afef\",\n    class: \"#e5c07b\",\n    attr: \"#d19a66\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#282c34\",\n    fg: \"#abb2bf\",\n    accent: \"#61afef\",\n    muted: \"#5c6370\",\n    isDark: true,\n  }),\n};\n\nconst oneLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#fafafa\",\n    fg: \"#383a42\",\n    comment: \"#a0a1a7\",\n    string: \"#50a14f\",\n    operator: \"#383a42\",\n    number: \"#986801\",\n    keyword: \"#a626a4\",\n    function: \"#4078f2\",\n    class: \"#c18401\",\n    attr: \"#986801\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#fafafa\",\n    fg: \"#383a42\",\n    accent: \"#4078f2\",\n    muted: \"#a0a1a7\",\n    isDark: false,\n  }),\n};\n\n// ---- Dracula ----\n\nconst draculaDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#282a36\",\n    fg: \"#f8f8f2\",\n    comment: \"#6272a4\",\n    string: \"#f1fa8c\",\n    operator: \"#f8f8f2\",\n    number: \"#bd93f9\",\n    keyword: \"#ff79c6\",\n    function: \"#50fa7b\",\n    class: \"#8be9fd\",\n    attr: \"#50fa7b\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#282a36\",\n    fg: \"#f8f8f2\",\n    accent: \"#bd93f9\",\n    muted: \"#6272a4\",\n    isDark: true,\n  }),\n};\n\nconst draculaLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#f8f8f2\",\n    fg: \"#282a36\",\n    comment: \"#9ea2b0\",\n    string: \"#6d6b0b\",\n    operator: \"#282a36\",\n    number: \"#7c5cbf\",\n    keyword: \"#c4358c\",\n    function: \"#2b9e4d\",\n    class: \"#1b8bc1\",\n    attr: \"#2b9e4d\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#f8f8f2\",\n    fg: \"#282a36\",\n    accent: \"#7c5cbf\",\n    muted: \"#9ea2b0\",\n    isDark: false,\n  }),\n};\n\n// ---- Nord ----\n\nconst nordDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#2e3440\",\n    fg: \"#d8dee9\",\n    comment: \"#4c566a\",\n    string: \"#a3be8c\",\n    operator: \"#81a1c1\",\n    number: \"#b48ead\",\n    keyword: \"#81a1c1\",\n    function: \"#88c0d0\",\n    class: \"#8fbcbb\",\n    attr: \"#d08770\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#2e3440\",\n    fg: \"#d8dee9\",\n    accent: \"#88c0d0\",\n    muted: \"#4c566a\",\n    isDark: true,\n  }),\n};\n\nconst nordLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#eceff4\",\n    fg: \"#2e3440\",\n    comment: \"#9da5b4\",\n    string: \"#a3be8c\",\n    operator: \"#5e81ac\",\n    number: \"#b48ead\",\n    keyword: \"#5e81ac\",\n    function: \"#4096ac\",\n    class: \"#3b8686\",\n    attr: \"#d08770\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#eceff4\",\n    fg: \"#2e3440\",\n    accent: \"#5e81ac\",\n    muted: \"#9da5b4\",\n    isDark: false,\n  }),\n};\n\n// ---- Vitesse ----\n\nconst vitesseDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#121212\",\n    fg: \"#dbd7ca\",\n    comment: \"#758575\",\n    string: \"#c98a7d\",\n    operator: \"#858585\",\n    number: \"#4c9a91\",\n    keyword: \"#4d9375\",\n    function: \"#80a665\",\n    class: \"#6893bf\",\n    attr: \"#bd976a\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#121212\",\n    fg: \"#dbd7ca\",\n    accent: \"#4d9375\",\n    muted: \"#758575\",\n    isDark: true,\n  }),\n};\n\nconst vitesseLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#ffffff\",\n    fg: \"#393a34\",\n    comment: \"#a0ada0\",\n    string: \"#b56959\",\n    operator: \"#999999\",\n    number: \"#2f798a\",\n    keyword: \"#1e754f\",\n    function: \"#59873a\",\n    class: \"#2e5dab\",\n    attr: \"#b07d48\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#ffffff\",\n    fg: \"#393a34\",\n    accent: \"#1e754f\",\n    muted: \"#a0ada0\",\n    isDark: false,\n  }),\n};\n\n// ---- Monokai ----\n\nconst monokaiDark: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#272822\",\n    fg: \"#f8f8f2\",\n    comment: \"#75715e\",\n    string: \"#e6db74\",\n    operator: \"#f8f8f2\",\n    number: \"#ae81ff\",\n    keyword: \"#f92672\",\n    function: \"#a6e22e\",\n    class: \"#66d9ef\",\n    attr: \"#a6e22e\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#272822\",\n    fg: \"#f8f8f2\",\n    accent: \"#f92672\",\n    muted: \"#75715e\",\n    isDark: true,\n  }),\n};\n\nconst monokaiLight: CodeBlockThemeConfig = {\n  syntax: createSyntaxTheme({\n    bg: \"#fafaf8\",\n    fg: \"#49483e\",\n    comment: \"#b3b1a4\",\n    string: \"#9e8e2c\",\n    operator: \"#49483e\",\n    number: \"#8b68d0\",\n    keyword: \"#c0195e\",\n    function: \"#7ea21a\",\n    class: \"#4798b3\",\n    attr: \"#7ea21a\",\n  }),\n  vars: createCodeBlockThemeVars({\n    bg: \"#fafaf8\",\n    fg: \"#49483e\",\n    accent: \"#c0195e\",\n    muted: \"#b3b1a4\",\n    isDark: false,\n  }),\n};\n\n// ============================================\n// 主题注册表\n// ============================================\n\n/** 所有内置主题（每个包含 light/dark 变体） */\nexport const codeBlockThemes: Record<\n  CodeBlockColorThemeName,\n  { light: CodeBlockThemeConfig; dark: CodeBlockThemeConfig }\n> = {\n  qiuvision: { light: qiuvisionLight, dark: qiuvisionDark },\n  github: { light: githubLight, dark: githubDark },\n  one: { light: oneLight, dark: oneDark },\n  dracula: { light: draculaLight, dark: draculaDark },\n  nord: { light: nordLight, dark: nordDark },\n  vitesse: { light: vitesseLight, dark: vitesseDark },\n  monokai: { light: monokaiLight, dark: monokaiDark },\n};\n\n// ============================================\n// 主题解析\n// ============================================\n\n/** 判断对象是否为 PrismTheme */\nfunction isPrismTheme(obj: unknown): obj is PrismTheme {\n  return (\n    typeof obj === \"object\" &&\n    obj !== null &&\n    \"plain\" in obj &&\n    \"styles\" in obj\n  );\n}\n\n/** 判断对象是否为 CodeBlockThemeConfig */\nfunction isThemeConfig(obj: unknown): obj is CodeBlockThemeConfig {\n  return (\n    typeof obj === \"object\" &&\n    obj !== null &&\n    \"syntax\" in obj &&\n    \"vars\" in obj\n  );\n}\n\n/**\n * 解析代码块主题\n *\n * 优先级：customTheme > colorTheme > 默认（qiuvision）\n *\n * @param colorTheme - 内置主题名称\n * @param customTheme - 自定义主题（CodeBlockThemeConfig 或 PrismTheme）\n * @param isDark - 是否深色模式（用于选择内置主题的深色/浅色变体）\n */\nexport function resolveCodeBlockTheme(\n  colorTheme?: CodeBlockColorThemeName,\n  customTheme?: CodeBlockThemeConfig | PrismTheme,\n  isDark: boolean = true,\n): CodeBlockThemeConfig {\n  // 自定义主题优先\n  if (customTheme) {\n    if (isThemeConfig(customTheme)) {\n      return customTheme;\n    }\n    if (isPrismTheme(customTheme)) {\n      // 从 PrismTheme 自动推导 UI 配色（明暗自动检测）\n      return deriveThemeFromPrism(customTheme);\n    }\n  }\n\n  // 使用内置主题\n  const themeName = colorTheme || \"qiuvision\";\n  const themePair = codeBlockThemes[themeName] || codeBlockThemes.qiuvision;\n  return isDark ? themePair.dark : themePair.light;\n}\n\n/**\n * 将 CodeBlockThemeVars 转为 CSS 自定义属性对象\n *\n * 返回的对象可直接作为 React 元素的 style 属性（需 as React.CSSProperties）\n */\nexport function themeVarsToCSSProperties(\n  vars: CodeBlockThemeVars,\n): Record<string, string> {\n  return {\n    \"--cb-bg\": vars.bg,\n    \"--cb-bg-rgb\": vars.bgRgb,\n    \"--cb-border\": vars.border,\n    \"--cb-hover\": vars.hover,\n    \"--cb-hover-solid\": vars.hoverSolid,\n    \"--cb-ln-color\": vars.lnColor,\n    \"--cb-ln-border\": vars.lnBorder,\n    \"--cb-sb-thumb\": vars.sbThumb,\n    \"--cb-sb-thumb-hover\": vars.sbThumbHover,\n    \"--cb-sb-track\": vars.sbTrack,\n    \"--cb-btn-text\": vars.btnText,\n    \"--cb-btn-border\": vars.btnBorder,\n    \"--cb-btn-hover-text\": vars.btnHoverText,\n    \"--cb-btn-hover-border\": vars.btnHoverBorder,\n    \"--cb-spotlight\": vars.spotlight,\n    \"--cb-shadow\": vars.shadow,\n    \"--cb-shadow-lg\": vars.shadowLg,\n  };\n}\n"
    },
    {
      "type": "registry:component",
      "path": "components/qiuye-ui/code-block/index.ts",
      "content": "export * from \"./code-block\";\nexport * from \"./code-block-panel\";\n"
    }
  ]
}
